# テストドキュメント
本ガイドはテストを行う際のガイドを行うものです。

## テストの目的
ここではソフトウエアの一般的なテストの意義について解説します。  
多くのソフトウエアでは継続的にバージョンアップされており、そのバージョンアップ時に多くのソフトウエアのリグレッションに遭遇します。  
リグレッションとはある変更により混入されたバグのことで、バージョンアップ時に予期せぬ形で入り込む事が多くあります。
このリグレッションはソフトウエアの複雑さによって引き起こされますが、ある時点においてそのコードに対する一つの変更が引き起こすものを推測するのは難しくなります。

そのため、リグレッションを避けるために変更のたびにソフトウエアが提供する機能をテストするべき、と考え導入するのがソフトウエアにおけるテストの大きな意義となります。

## 本ガイドにおける「テスト」　の定義と概要
テストには様々な種類があり、Web アプリケーションを作成する際のソフトウエアのテストには、下記のような種類があります。

| テスト種類 |  テスト内容の概要  | 実行タイミング    |
|---------------|---------|--------------------------------|
| ユニットテスト<br>（単体テスト）| ソフトウエアの最小単位に行うテスト | 随時（開発途中）、Push時などが多い  |
| 統合テスト<br>（結合テスト）   | ユニットテストより高水準のテストを指し、通常複数のアプリケーションやDB相互のやり取りなどの境界に注目し、大きな塊のコードのテスを行う。      | アプリケーションが肥大化し、外部システムと統合した状態になった時 |
| 受け入れテスト（UAT=User Acceptance Test）| 機能にフォーカスしたテストで、ソフトウエアをブラックボックスとして扱い、ユーザーと同等のUIを用いて機能を確認する。最終工程として行われる事が多い。 | 成果物の最終確認・納品物としての検修時など |
| 負荷テスト           | ユーザーからの同時リクエスト数など、アプリケーションの性能限界を見極めるためのテスト     | 本番リリース直前など、ある程度機能が固まった時期  |
| パフォーマンステスト       | コードのパフォーマンス全般のテストを指す。負荷テストもこの一種として捉えられる場合もある      | 本番リリース直前など、ある程度機能が固まった時期  |
| コード品質テスト      | コード品質と高い相関性があると呼ばれる指標を用いてコード自体の品質をチェックするテスト | 随時（リファクタリング時）、コードPush時   |

本資料では主として基本部分にあたる単体テストの方式と実践例を示します。

## テスト環境の準備 
本プロジェクトのルートディレクトリに移動し、下記を実行してください。  
```
pip install -e .
```
setup.py、が実行され、必要なライブラリのインストール及びディレクトリの依存関係がインストールされます。

上記に加え、テストを実行する前には、下記を実行してください。
```
pip install -e test
```

## テストの実行
* テストを実行する際には、プロジェクトのルートディレクトリにて下記を実行します。

```
python -m pytest -v tests/test_kalman.py
```
を実行します。

## テストシナリオ
本テストでは、下記を実行しています。  

| テストメソッド名 |  テスト内容の概要  | テスト条件 |
|---------------|---------|--------------------------------|
| test_initKalman | インスタンス初期化時の変数チェック | 引数とインスタンス初期化時の変数の値が一致する事 |
| test_initConfigKalaman | インスタンス初期化時の変数チェック | Configファイルからの変数とインスタンス初期化時の変数の値が一致する事 |
| test_normalKalman | カルマンインスタンスが様々な入力パラメータの元で正常終了するためのチェック | エラー・例外が発生せず、全ての異常スコアが閾値未満であること |
| test_exceedMissingCountError | 異常系。推定エラーを引き起こした回数が閾値を超えた場合にエラー終了する事のテスト | 変数が閾値を上回り、期待されたエラーメッセージが発生する事 |
| test_exceedWidthError | 異常系。推定幅が閾値を超えた場合にエラー終了する事のテスト | 変数が閾値を上回り、期待されたエラーメッセージが発生する事 
| test_exceedRangeError | 異常系。画像上端・下端に推定値が到達し、推定不能となった場合にエラー終了する事のテスト | 変数が閾値を上回り、期待されたエラーメッセージが発生する事 

## テストの構造
testsの構造は以下のようになっています。
```
.
├── __init__.py     # 初期化ファイル。
├── conftest.py     # テスト実行時に共通する前処理などを記述するfixture記述するソースコード
├── test_kalman.py  # テストの実行ファイル
└── README.md       # 本資料
```


## 参考文献
* [Pytest.org](https://docs.pytest.org/en/7.1.x/index.html)
* [テスト駆動Python 第二版](https://www.shoeisha.co.jp/book/detail/9784798177458)
* [エキスパートPythonプログラミング](https://www.kadokawa.co.jp/product/302105001236/)
* [単体テストの考え方/使い方](https://book.mynavi.jp/ec/products/detail/id=134252)